<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Health Records System - Home</title>
  <link rel="stylesheet" href="assets/style.css" />
  <style>
    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .user-info {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .user-info h2 {
      margin: 0;
      color: #333;
    }
    .btn-logout {
      background: #d32f2f;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn-logout:hover {
      background: #b71c1c;
    }
    .users-section {
      margin-top: 40px;
    }
    .users-section h3 {
      color: #333;
      margin-bottom: 20px;
      font-size: 22px;
    }
    .users-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    .users-table thead {
      background: #667eea;
      color: white;
    }
    .users-table th, .users-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    .users-table tbody tr:hover {
      background: #f9f9f9;
    }
    .users-table tbody tr:last-child td {
      border-bottom: none;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-decoration: none;
      color: #667eea;
      font-weight: 600;
      text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
  </style>
  <script defer src="assets/dashboard.js"></script>
  <script>
    // Check if user is logged in
    document.addEventListener('DOMContentLoaded', () => {
      const user = localStorage.getItem('user');
      if (!user) {
        window.location.href = 'login.html';
      } else {
        updateWelcomeMessage();
        loadRegisteredUsers();
      }
    });
    function updateWelcomeMessage() {
      const userStr = localStorage.getItem('user');
      if (userStr) {
        const user = JSON.parse(userStr);
        document.getElementById('welcomeName').textContent = 'Welcome, ' + user.name + '!';
        document.getElementById('userEmail').textContent = user.email;
      }
    }

    async function loadRegisteredUsers() {
      try {
        const response = await fetch('/api/auth/users', { method: 'POST' });
        if (response.ok) {
          const data = await response.json();
          displayUsers(data.users);
        }
      } catch (err) {
        console.error('Failed to load users:', err);
      }
    }

    function displayUsers(users) {
      const tbody = document.querySelector('.users-table tbody');
      if (users.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No registered users yet</td></tr>';
        return;
      }

      tbody.innerHTML = users.map(user => `
        <tr>
          <td>${user.id}</td>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>${user.role || 'patient'}</td>
        </tr>
      `).join('');
    }

    function logout() {
      localStorage.removeItem('user');
      localStorage.removeItem('token');
      window.location.href = 'login.html';
    }
  </script>
</head>
<body>
  <div class="dashboard">
    <div class="user-info">
      <div>
        <h2 id="welcomeName">Welcome!</h2>
        <p id="userEmail" style="margin: 5px 0; color: #666;"></p>
      </div>
      <button class="btn-logout" onclick="logout()">Logout</button>
    </div>

    <div class="users-section">
      <h3>All Registered Users</h3>
      <table class="users-table">
        <thead>
          <tr>
            <th>User ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="3" style="text-align: center;">Loading...</td></tr>
        </tbody>
      </table>
    </div>

    <h3 style="margin-top: 40px; color: #333;">Select your role to continue</h3>
    <div class="grid">
      <a href="patient.html" class="card">Patient</a>
      <a href="doctor.html" class="card">Doctor / Healthcare Provider</a>
      <a href="nurse.html" class="card">Nurse / Medical Staff</a>
      <a href="admin.html" class="card">Admin / Hospital Administrator</a>
    <a href="lab.html" class="card">Lab Technician</a>
    <a href="pharmacist.html" class="card">Pharmacist</a>
  </main>
  <footer>
    <small>&copy; 2025 Health Records System Demo</small>
  </footer>
</body>
</html>
